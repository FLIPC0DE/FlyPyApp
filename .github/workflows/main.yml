name: PyFly CI - Basic

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

env:
  NODE_VERSION: '18.x'

jobs:
  # Job 1: Verificaci√≥n b√°sica
  hello-world:
    name: Hello World - PyFly
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Saludar
        run: |
          echo "üöÄ ¬°Bienvenido a PyFly!"
          echo "üìÖ Fecha: $(date)"
          echo "üåø Branch: ${{ github.ref_name }}"
          echo "üë§ Usuario: ${{ github.actor }}"
          echo "üí¨ Commit: ${{ github.event.head_commit.message }}"

      - name: Mostrar info del proyecto
        run: |
          echo "================================"
          echo "   PROYECTO PYFLY - CI/CD"
          echo "================================"
          echo "Stack: React + Node.js + PostgreSQL"
          echo "Sprints: 6 sprints de 2 semanas"
          echo "Equipo: 4 desarrolladores"
          echo "================================"

  # Job 2: Verificar estructura del proyecto
  check-structure:
    name: Verificar Estructura
    runs-on: ubuntu-latest
    needs: hello-world
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Listar archivos del proyecto
        run: |
          echo "üìÇ Estructura del proyecto:"
          ls -la
          
      - name: Verificar carpetas principales
        run: |
          echo "Verificando carpetas esperadas..."
          if [ -d "BACKEND" ]; then
            echo "‚úÖ Carpeta BACKEND encontrada"
          else
            echo "‚ö†Ô∏è  Carpeta BACKEND no encontrada (ser√° creada m√°s adelante)"
          fi
          
          if [ -d "FRONTEND" ]; then
            echo "‚úÖ Carpeta FRONTEND encontrada"
          else
            echo "‚ö†Ô∏è  Carpeta FRONTEND no encontrada (ser√° creada m√°s adelante)"
          fi

  # Job 3: Lint Backend (si existe)
  lint-backend:
    name: Lint Backend
    runs-on: ubuntu-latest
    needs: check-structure
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verificar si existe Backend
        id: check-backend
        run: |
          if [ -f "BACKEND/package.json" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "‚úÖ Backend encontrado"
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "‚ö†Ô∏è Backend no encontrado, saltando lint"
          fi

      - name: Setup Node.js
        if: steps.check-backend.outputs.exists == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: BACKEND/package-lock.json

      - name: Instalar dependencias
        if: steps.check-backend.outputs.exists == 'true'
        working-directory: ./BACKEND
        run: npm ci

      - name: Ejecutar ESLint
        if: steps.check-backend.outputs.exists == 'true'
        working-directory: ./BACKEND
        run: npm run lint || echo "‚ö†Ô∏è Lint no configurado a√∫n"

  # Job 4: Lint Frontend (si existe)
  lint-frontend:
    name: Lint Frontend
    runs-on: ubuntu-latest
    needs: check-structure
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verificar si existe Frontend
        id: check-frontend
        run: |
          if [ -f "FRONTEND/FlyPyApp/package.json" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "‚úÖ Frontend encontrado"
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "‚ö†Ô∏è Frontend no encontrado, saltando lint"
          fi

      - name: Setup Node.js
        if: steps.check-frontend.outputs.exists == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: FRONTEND/FlyPyApp/package-lock.json

      - name: Instalar dependencias
        if: steps.check-frontend.outputs.exists == 'true'
        working-directory: ./FRONTEND/FlyPyApp
        run: npm ci

      - name: Ejecutar ESLint
        if: steps.check-frontend.outputs.exists == 'true'
        working-directory: ./FRONTEND/FlyPyApp
        run: npm run lint || echo "‚ö†Ô∏è Lint no configurado a√∫n"

  # Job 5: Resumen final
  summary:
    name: Resumen de CI
    runs-on: ubuntu-latest
    needs: [hello-world, check-structure, lint-backend, lint-frontend]
    if: always()
    
    steps:
      - name: Mostrar resumen
        run: |
          echo "================================"
          echo "   RESUMEN DE EJECUCI√ìN"
          echo "================================"
          echo "‚úÖ Workflow ejecutado correctamente"
          echo "üìä Jobs completados:"
          echo "   - Hello World: ${{ needs.hello-world.result }}"
          echo "   - Verificaci√≥n estructura: ${{ needs.check-structure.result }}"
          echo "   - Lint Backend: ${{ needs.lint-backend.result }}"
          echo "   - Lint Frontend: ${{ needs.lint-frontend.result }}"
          echo "================================"
          echo "üéâ ¬°CI b√°sico funcionando!"
          echo "================================"